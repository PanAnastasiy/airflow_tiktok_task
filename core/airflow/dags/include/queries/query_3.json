
[
  {
    "$addFields": {
      "numeric_score": {
        "$convert": {
          "input": "$score",
          "to": "double",
          "onError": null,
          "onNull": null
        }
      }
    }
  },
  {
    "$match": {
      "numeric_score": { "$ne": null }
    }
  },
  {
    "$group": {
      "_id": {
        "$dateTrunc": {
          "date": "$at",
          "unit": "day"
        }
      },
      "average_rating": { "$avg": "$numeric_score" }
    }
  },
  {
    "$sort": { "_id": 1 }
  }
]
